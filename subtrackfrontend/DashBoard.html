<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SubTrack - Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body {
    background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('images/background.jpg');
    background-size: cover;
    background-position: center;
    min-height: 100vh;
    color: #fff;
    font-family: 'Segoe UI', sans-serif;
}

.navbar { background-color: rgba(0, 0, 0, 0.6); }
.navbar-brand { font-weight: bold; font-size: 1.5rem; color: #fff !important; }
.nav-link { color: #ddd !important; margin-right: 15px; }
.nav-link:hover { color: #fff !important; }

.btn-gradient { 
    background: linear-gradient(to right, #270D7D, #281A84, #2C4FA0, #2D5CA7); 
    color:#fff; border:none; padding:8px 18px; border-radius:8px; font-weight:bold; 
}
.btn-gradient:hover { 
    background: linear-gradient(to right, #2D5CA7, #2C4FA0, #281A84, #270D7D); 
}

.dashboard { padding: 50px 30px; }
@media (max-width: 767.98px){ .dashboard { padding: 20px 15px; } }
.dashboard h2{ font-weight:bold; margin-bottom:30px; }

.card-dashboard {
    background: rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card-dashboard:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.4); }
.card-dashboard i { font-size: 2rem; margin-bottom:10px; color:#2D5CA7; }
.card-dashboard h5 { color:#fff; font-weight:bold; margin-bottom:5px; }
.card-dashboard p { color:#ccc; font-size:0.9rem; }

.activity{ margin-top:40px; }
.activity h4{ margin-bottom:20px; font-weight:bold; }
.activity-list { background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 20px; }
.activity-item { display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid rgba(255,255,255,0.1); color:#ccc; }
.activity-item:last-child{ border-bottom:none; }
.activity-item span{ color:#2D5CA7; font-weight:bold; }

.sidebar { background: rgba(255,255,255,0.05); min-height:100vh; padding:20px; transition: transform 0.3s ease; }
@media (max-width:991.98px){
    .sidebar{ position:fixed; top:0; left:-220px; width:220px; height:100%; z-index:1050; transition:left 0.3s ease-in-out; }
    .sidebar.show{ left:0; }
    .main-content{ transition: margin-left 0.3s ease-in-out; }
    .main-content.pushed{ margin-left:220px; }
}

footer{ background-color: rgba(0,0,0,0.85); color:#fff; padding:40px 20px; }
footer h5{ font-weight:bold; margin-bottom:15px; }
footer a:hover{ text-decoration:underline; }
#reminderCount {
    display: inline-block; /* ‚ùó important for transform animation */
    transition: transform 0.3s ease-in-out;
}

#reminderCount.animate {
    animation: bounce 0.5s ease-in-out;
}

@keyframes bounce {
    0% { transform: scale(1); }
    50% { transform: scale(1.5); }
    100% { transform: scale(1); }
}

</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg">
<div class="container">
    <a class="navbar-brand" href="#">SubTrack</a>
    <button class="btn btn-gradient ms-3 d-lg-none" id="sidebarToggle"><i class="fa fa-bars"></i></button>
    <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link" href="./DashBoard.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="./Plans1.html">Plans</a></li>
            <li class="nav-item"><a class="nav-link" href="./Contact1.html">Contact</a></li>
            <li class="nav-item"><a class="nav-link" href="./About1.html">About</a></li>
        </ul>
        <a href="logout.html" class="btn btn-gradient ms-3">Logout</a>
    </div>
</div>
</nav>

<div class="container-fluid">
<div class="row">

<div class="col-lg-2 sidebar" id="sidebar">
<h4 style="text-align: center;">Menu</h4>
<nav class="nav flex-column">
    <a class="nav-link active" href="./DashBoard.html"><i class="fa fa-home"></i> Dashboard</a>
    <a class="nav-link" href="./MySubScription.html"><i class="fa fa-list"></i> My Subscriptions</a>
    <a class="nav-link" href="./Reminders.html">
    <i class="fa fa-bell"></i> Reminders 
    <span id="reminderCount" class="badge bg-warning text-dark ms-1">0</span>
</a>

    <a class="nav-link" href="Profile.html"><i class="fa fa-user"></i> Profile</a>
</nav>
</div>

<div class="col-12 col-lg-10 dashboard" id="mainContent">
<h2 id="welcomeText">Welcome Back üëã</h2>

<div class="row g-4">
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card-dashboard">
            <i class="fa fa-list"></i>
            <h5>Active Subscriptions</h5>
            <p id="activeSubs">0 Plans</p>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card-dashboard">
            <i class="fa fa-bell"></i>
            <h5>Upcoming Renewals</h5>
            <p id="upcomingRenewals">0 This Week</p>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card-dashboard">
            <i class="fa fa-chart-line"></i>
            <h5>Monthly Spending</h5>
            <p id="monthlySpending">‚Çπ0</p>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card-dashboard">
            <i class="fa fa-pause-circle"></i>
            <h5>Paused Subscriptions</h5>
            <p id="pausedSubs">0 Paused</p>
        </div>
    </div>
    
</div>

<div class="activity">
    <h4>Recent Activity</h4>
    <div class="activity-list" id="activityList"></div>
</div>
</div>
</div>
</div>

<footer>
<div class="container">
    <div class="row text-start">
        <div class="col-md-4 mb-4">
            <h5>About SubTrack</h5>
            <p>SubTrack helps you manage all your app subscriptions in one place. Get reminders, track expenses, and avoid paying for unused services.</p>
        </div>
        <div class="col-md-4 mb-4">
            <h5>Quick Links</h5>
            <ul class="list-unstyled">
                <li><a href="./Homepage1.html" class="text-white text-decoration-none">Home</a></li>
                <li><a href="./Plans1.html" class="text-white text-decoration-none">Plan</a></li>
                <li><a href="./Contact1.html" class="text-white text-decoration-none">Contact</a></li>
                <li><a href="./About1.html" class="text-white text-decoration-none">About</a></li>
            </ul>
        </div>
        <div class="col-md-4 mb-4">
            <h5>Contact Us</h5>
            <p><i class="fa fa-envelope"></i> support@subtrack.com</p>
            <p><i class="fa fa-phone"></i> +91 98765 43210</p>
        </div>
    </div>
</div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const sidebar = document.getElementById('sidebar');
const toggleBtn = document.getElementById('sidebarToggle');
toggleBtn.addEventListener('click', () => { sidebar.classList.toggle('show'); });

// Get user from localStorage
const user = JSON.parse(localStorage.getItem('user'));
if(user){
    document.getElementById('welcomeText').textContent = `Welcome Back, ${user.name} üëã`;
} else {
    window.location.href = 'Login.html';
}

// Animate reminder badge
function updateReminderBadge(count) {
    const badge = document.getElementById('reminderCount');
    badge.textContent = count;
    badge.classList.remove('animate');
    void badge.offsetWidth; // restart animation
    badge.classList.add('animate');
    setTimeout(() => badge.classList.remove('animate'), 500);
}

// Fetch subscriptions and update dashboard
async function updateDashboard() {
    try {
        const res = await fetch(`http://localhost:3000/api/subscriptions?email=${user.email}`);
        const subs = await res.json();

        const today = new Date();
        const weekLater = new Date();
        weekLater.setDate(today.getDate() + 7);

        // Initialize counters
        let activeCount = 0, pausedCount = 0, renewedCount = 0, totalSpending = 0, upcomingCount = 0;

        const activityList = document.getElementById('activityList');
        activityList.innerHTML = '';

        subs.forEach(sub => {
            const activity = sub.activity?.toLowerCase() || '';

            // Count activity types
            if (activity === 'active') activeCount++;
            else if (activity === 'paused') pausedCount++;
            else if (activity === 'renewed') renewedCount++;

            // Calculate total spending
            totalSpending += parseFloat(sub.price || 0);

            // Count upcoming renewals within 7 days
            const expiry = new Date(sub.expiryDate);
            if (expiry >= today && expiry <= weekLater && activity === 'active') {
                upcomingCount++;
            }
        });

        // üü¢ Update dashboard counts
        document.getElementById('activeSubs').textContent = `${activeCount} Active`;
        document.getElementById('pausedSubs').textContent = `${pausedCount} Paused`;
        document.getElementById('upcomingRenewals').textContent = `${renewedCount} Renewals`;
        document.getElementById('monthlySpending').textContent = `‚Çπ${totalSpending.toLocaleString()}`;

        // Animate reminder badge for upcoming renewals
        updateReminderBadge(upcomingCount);

        // üü£ Show recent activities
        const recentSubs = subs.slice(-3).reverse();
        recentSubs.forEach(sub => {
            const div = document.createElement('div');
            div.classList.add('activity-item');
            div.innerHTML = `<span>${sub.name}</span> ${sub.activity} ‚Äì ‚Çπ${sub.price}`;
            activityList.appendChild(div);
        });

    } catch (err) {
        console.error('Error fetching subscriptions:', err);
    }
}

updateDashboard();
</script>

</body>
</html>
