<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SubTrack - Reminders</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body {
    background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('images/background.jpg');
    background-size: cover;
    background-position: center;
    min-height: 100vh;
    color: #fff;
    font-family: 'Segoe UI', sans-serif;
}
.navbar { background-color: rgba(0,0,0,0.6); }
.navbar-brand { font-weight: bold; font-size: 1.5rem; color: #fff !important; }
.nav-link { color: #ddd !important; margin-right: 15px; }
.nav-link:hover { color: #fff !important; }
.btn-gradient { background: linear-gradient(to right, #270D7D, #281A84, #2C4FA0, #2D5CA7); color:#fff; border:none; padding:8px 18px; border-radius:8px; font-weight:bold; }
.btn-gradient:hover { background: linear-gradient(to right, #2D5CA7, #2C4FA0, #281A84, #270D7D); }

.container { padding: 50px 30px; }
h2{ font-weight:bold; margin-bottom:30px; }

.reminder-list { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; }
.reminder-item { display:flex; justify-content:space-between; align-items:center; padding:15px; border-bottom:1px solid rgba(255,255,255,0.1); color:#ccc; }
.reminder-item:last-child { border-bottom:none; }
.reminder-item span { font-weight:bold; color:#2D5CA7; }
.reminder-item i { font-size:1.2rem; color:#ffc107; }

</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg">
<div class="container">
    <a class="navbar-brand" href="#">SubTrack</a>
    <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link" href="./DashBoard.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="./Plans.html">Plans</a></li>
            <li class="nav-item"><a class="nav-link" href="./Contact1.html">Contact</a></li>
            <li class="nav-item"><a class="nav-link" href="./About1.html">About</a></li>
        </ul>
        <a href="logout.html" class="btn btn-gradient ms-3">Logout</a>
    </div>
</div>
</nav>

<div class="container">
<h2>Upcoming Reminders</h2>
<div class="reminder-list" id="reminderList">
    <!-- Reminders injected here -->
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Get user from localStorage
const user = JSON.parse(localStorage.getItem('user'));
if(!user) window.location.href='Login.html';

async function loadReminders() {
    try {
        const res = await fetch(`http://localhost:3000/api/subscriptions?email=${user.email}`);
        const subs = await res.json();
        const today = new Date();
        const reminderList = document.getElementById('reminderList');
        reminderList.innerHTML = '';

        let hasReminders = false;

        subs.forEach(sub => {
            const expiry = new Date(sub.expiryDate);
            const diffDays = Math.ceil((expiry - today)/(1000*60*60*24));
            if(diffDays <= 7){
                hasReminders = true;
                const div = document.createElement('div');
                div.classList.add('reminder-item');
                div.innerHTML = `<span>${sub.name}</span> Expiring in ${diffDays} day(s) – ₹${sub.price} <i class="fa fa-bell"></i>`;

                // Redirect to MySubscriptions when clicked
                div.style.cursor = 'pointer'; // show pointer
                div.addEventListener('click', () => {
                    window.location.href = './MySubScription.html';
                });

                reminderList.appendChild(div);
            }
        });

        if(!hasReminders){
            reminderList.innerHTML = `<p class="text-muted">No upcoming reminders this week.</p>`;
        }

    } catch(err){
        console.error('Error loading reminders:', err);
    }
}

loadReminders();
</script>


</body>
</html>
